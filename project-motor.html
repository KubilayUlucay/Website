<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project: Remote-Controlled Axial Flux Motor | Kubilay Ulucay</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&family=Montserrat:wght@400;600;700&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Honk&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" xintegrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link
        rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’¡</text></svg>">
    <style>
        /* Styles for project page elements */
        .slides-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: var(--card-border);
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-bottom: 1.5rem;
        }
        .slides-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        .main-project-image-container {
            margin-bottom: 0.5rem;
            text-align: center;
        }
        .main-project-image-container img {
            max-height: 500px;
            width: auto;
            max-width: 100%;
            display: inline-block;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--card-border);
        }

        /* === GALLERY & LIGHTBOX STYLES === */
        .project-gallery .gallery-item {
            aspect-ratio: 4 / 3;
            overflow: hidden;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        .project-gallery .gallery-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        .project-gallery .gallery-item:hover img {
            transform: scale(1.05);
        }
        #lightbox-modal {
            transition: opacity 0.3s ease;
        }
        #lightbox-modal.hidden {
            opacity: 0;
            pointer-events: none;
        }
        body.lightbox-open {
            overflow: hidden;
        }
        #prev-lightbox, #next-lightbox {
            transition: color 0.2s ease;
            user-select: none;
        }
        #prev-lightbox:hover, #next-lightbox:hover {
            color: #ccc;
        }

        /* Music Player styles */
        #project-page-music-player-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 280px;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
            box-shadow: 0 5px 15px -3px var(--shadow-color), 0 4px 6px -4px var(--shadow-color);
            border-radius: 0.5rem;
            padding: 1rem;
            color: var(--text-color);
            z-index: 999; 
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            transform: translateY(0%); 
            opacity: 1;
        }
        #project-page-music-player-panel.hidden-player {
            transform: translateY(150%); 
            opacity: 0;
            pointer-events: none;
        }
        #project-page-music-player-panel h4 {
            font-family: 'Montserrat', sans-serif;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            color: var(--text-color-secondary);
        }
        #toggle-project-music-player-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: var(--accent1);
            color: white;
            border: none;
            width: 48px; 
            height: 48px; 
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            transition: background-color 0.3s ease, transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000; 
        }
        #toggle-project-music-player-btn:hover {
            background-color: var(--accent2);
            transform: scale(1.1);
        }
         body.dark-theme #toggle-project-music-player-btn {
            background-color: var(--accent3);
        }
        body.dark-theme #toggle-project-music-player-btn:hover {
            background-color: var(--accent1);
        }
        #toggle-project-music-player-btn i {
            font-size: 1.2rem; 
        }
    </style>
</head>
<body class="font-rubik selection:bg-blue-200 selection:text-blue-900">
    <header class="sticky top-0 z-40 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-3xl font-montserrat nav-link flex-shrink-0 mr-6">
                Kubilay Ulucay
            </a>
            <div class="flex items-center space-x-4">
                <a href="index.html#projects" class="nav-link flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Projects
                </a>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-6 py-12">
        <section class="card-bg p-6 md:p-8 rounded-lg shadow-lg">
            <h1 class="text-4xl md:text-5xl font-semibold mb-3 font-montserrat card-title">
                Remote-Controlled Axial Flux Motor
            </h1>
            <p class="text-lg text-[var(--text-color-secondary)] mb-6">
                A hands-on project involving the design, fabrication, and testing of a custom electric motor.
            </p>

            <div class="mb-8 main-project-image-container">
                <img src="images/Projects/Motor/overall-motor.jpeg" alt="Overall view of the Axial Flux Motor" onerror="this.src='https://placehold.co/800x500/1f2937/9ca3af?text=Motor'">
                <p class="text-sm text-[var(--text-color-secondary)] mt-2"><i>Overall view of the completed motor prototype.</i></p>
            </div>

            <div class="mb-8">
                <h2 class="text-3xl font-semibold mb-4 card-title border-b pb-2 border-[var(--card-border)]">Project Overview</h2>
                <p class="text-lg leading-relaxed mb-4 card-text">
                    This project involved the complete lifecycle of creating a custom electric axial flux motor. The primary goal was to design a motor from scratch, fabricate its components including hand-wiring the coils, and integrate a remote control system using NRF24L01 transceivers for wireless operation. This endeavor aimed to provide practical experience in motor design principles, 3D printing for custom parts, and embedded systems programming for control.
                </p>
                <p class="text-lg leading-relaxed card-text">
                    The axial flux topology was chosen for its potential for high torque density and compact form factor. The project served as an excellent learning platform for understanding electromagnetic principles, material selection, and the challenges of manual fabrication processes.
                </p>
            </div>

            <div class="mb-8">
                <h2 class="text-3xl font-semibold mb-4 card-title border-b pb-2 border-[var(--card-border)]">Key Features & Technologies</h2>
                <ul class="list-disc list-inside text-lg card-text space-y-3 pl-4">
                    <li>
                        <strong>Custom Motor Design:</strong> Designed an axial flux permanent magnet (AFPM) motor, including stator and rotor geometry, magnet placement, and coil winding specifications.
                    </li>
                    <li>
                        <strong>Hand-Wired Coils:</strong> Manually wound copper coils for the stator, providing a deep understanding of motor construction.
                    </li>
                    <li>
                        <strong>3D Printed Components:</strong> Utilized 3D printing (e.g., FDM with PLA/PETG) to create custom motor housing, rotor, and stator supports.
                    </li>
                    <li>
                        <strong>NRF24 Remote Control:</strong> Implemented a wireless remote control system using Arduino microcontrollers and NRF24L01+ transceiver modules for motor speed and direction control.
                    </li>
                    <li>
                        <strong>Custom PCB:</strong> Designed a compact PCB using KiCad for the motor driver and NRF24 module integration.
                    </li>
                    <li>
                        <strong>Technologies Used:</strong>
                        <ul class="list-disc list-inside ml-6 mt-1 space-y-1">
                            <li>Microcontrollers: Arduino (e.g., Nano, Uno)</li>
                            <li>Wireless Communication: NRF24L01+</li>
                            <li>CAD Software: Autodesk Fusion 360, SolidWorks</li>
                            <li>Slicing Software: Cura, PrusaSlicer</li>
                            <li>Programming: Arduino C/C++</li>
                            <li>Motor Control: L298N motor driver, Custom ESC (if applicable)</li>
                        </ul>
                    </li>
                </ul>
            </div>

            <div class="mb-8">
                <h2 class="text-3xl font-semibold mb-4 card-title border-b pb-2 border-[var(--card-border)]">Challenges & Solutions</h2>
                <p class="text-lg leading-relaxed mb-2 card-text">
                    During the project, several challenges were encountered and addressed:
                </p>
                <ul class="list-disc list-inside text-lg card-text space-y-2 pl-4">
                    <li><strong>Challenge:</strong> Achieving precise alignment of the rotor and stator with 3D printed parts, critical for optimal motor performance.
                        <br><span class="text-sm text-[var(--text-color-secondary)]"><strong>Solution:</strong> Implemented an iterative design process for the 3D models, incorporating adjustable mounting points and developing calibration jigs to ensure accurate assembly.</span>
                    </li>
                    <li><strong>Challenge:</strong> Ensuring reliable wireless communication with the NRF24 modules, especially in environments with potential RF interference.
                        <br><span class="text-sm text-[var(--text-color-secondary)]"><strong>Solution:</strong> Developed a robust communication protocol with error checking and retransmission capabilities. Careful antenna placement and power supply decoupling for the NRF24 modules also improved signal integrity.</span>
                    </li>
                    <li><strong>Challenge:</strong> Overheating of motor driver components (e.g., L298N) when operating the motor at higher loads or for extended periods.
                         <br><span class="text-sm text-[var(--text-color-secondary)]"><strong>Solution:</strong> Integrated heat sinks onto the motor driver IC and implemented current monitoring in the Arduino code to trigger a fault state or reduce power if overcurrent conditions were detected.</span>
                    </li>
                    <li><strong>Challenge:</strong> Optimizing the hand-winding process for the stator coils to achieve consistency and desired electrical characteristics.
                         <br><span class="text-sm text-[var(--text-color-secondary)]"><strong>Solution:</strong> Created winding guides and templates using 3D printing, and meticulously counted turns and ensured uniform tension during the winding process.</span>
                    </li>
                </ul>
            </div>

            <div class="mb-8">
                <h2 class="text-3xl font-semibold mb-4 card-title border-b pb-2 border-[var(--card-border)]">Visual Gallery</h2>
                <p class="text-lg leading-relaxed mb-4 card-text">
                    A collection of images showcasing the design, components, and assembly process of the remote-controlled axial flux motor.
                </p>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 project-gallery">
                     <a href="images/Projects/Motor/motor_3d.jpg" class="gallery-item" data-caption="3D Model of the Motor">
                        <img src="images/Projects/Motor/motor_3d.jpg" alt="3D Model of the Motor" onerror="this.src='https://placehold.co/800x600/1f2937/9ca3af?text=Image+Not+Found'">
                    </a>
                    <a href="images/Projects/Motor/motoric.jfif" class="gallery-item" data-caption="Motor Internal Components">
                        <img src="images/Projects/Motor/motoric.jfif" alt="Motor Internal Components" onerror="this.src='https://placehold.co/800x600/1f2937/9ca3af?text=Image+Not+Found'">
                    </a>
                    <a href="images/Projects/Motor/motor-inside-wiring.jpeg" class="gallery-item" data-caption="Motor Inside Wiring">
                        <img src="images/Projects/Motor/motor-inside-wiring.jpeg" alt="Motor Inside Wiring" onerror="this.src='https://placehold.co/800x600/1f2937/9ca3af?text=Image+Not+Found'">
                    </a>
                    <a href="images/Projects/Motor/refkumandaalici.jpeg" class="gallery-item" data-caption="Remote Control Receiver (Alici)">
                        <img src="images/Projects/Motor/refkumandaalici.jpeg" alt="Remote Control Receiver (Alici)" onerror="this.src='https://placehold.co/800x600/1f2937/9ca3af?text=Image+Not+Found'">
                    </a>
                    <a href="images/Projects/Motor/refkumandaverici.jpeg" class="gallery-item" data-caption="Remote Control Transmitter (Verici)">
                        <img src="images/Projects/Motor/refkumandaverici.jpeg" alt="Remote Control Transmitter (Verici)" onerror="this.src='https://placehold.co/800x600/1f2937/9ca3af?text=Image+Not+Found'">
                    </a>
                    <a href="images/Projects/Motor/overall-motor.jpeg" class="gallery-item" data-caption="Completed Motor Assembly">
                        <img src="images/Projects/Motor/overall-motor.jpeg" alt="Motor Assembly Process" onerror="this.src='https://placehold.co/800x600/1f2937/9ca3af?text=Image+Not+Found'">
                    </a>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="text-3xl font-semibold mb-4 card-title border-b pb-2 border-[var(--card-border)]">Presentation Slides</h2>
                <p class="text-lg leading-relaxed mb-4 card-text">
                    For a more detailed overview, including design considerations and testing results, please view the project presentation slides embedded below.
                </p>
                <div class="slides-container">
                    <iframe src="https://docs.google.com/presentation/d/e/2PACX-1vQUBwMfczfqOUSYRqaiwsZp53p_EiTMHzFyXLCIYR8RwIXHhLEea2tcqHZBJlwc2g/pubembed?start=false&loop=false&delayms=3000" frameborder="0" width="1280" height="749" allowfullscreen="true" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="text-3xl font-semibold mb-4 card-title border-b pb-2 border-[var(--card-border)]">Outcomes & Learning</h2>
                <p class="text-lg leading-relaxed card-text">
                    The project successfully resulted in a functional remote-controlled axial flux motor prototype that demonstrated the viability of the custom design and fabrication approach. Key learnings included a deeper understanding of electromagnetic field interactions within axial flux machines, and the nuances of implementing reliable wireless data transmission for real-time control applications. This project significantly enhanced my skills in iterative design, circuit integration, and hands-on fabrication techniques. It also provided valuable insights into importance of systematic testing and debugging.
                </p>
            </div>

            <div class="mt-12 text-center">
                <a href="index.html#projects" class="btn-pop inline-block bg-[var(--accent1)] hover:bg-[var(--accent2)] text-white font-semibold py-3 px-8 rounded-lg shadow-md transition">
                    <i class="fas fa-arrow-left mr-2"></i> Back to All Projects
                </a>
            </div>
        </section>
    </main>

    <!-- Lightbox Modal -->
    <div id="lightbox-modal" class="hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-90 flex justify-center items-center z-[1001]">
        <span id="close-lightbox" class="absolute top-4 right-6 text-white text-5xl font-bold cursor-pointer hover:text-gray-300 transition-colors">&times;</span>
        <span id="prev-lightbox" class="absolute left-6 text-white text-5xl font-bold cursor-pointer select-none hover:text-gray-300 transition-colors">&#10094;</span>
        <img id="lightbox-image" class="max-w-[90vw] max-h-[80vh] object-contain rounded-lg">
        <span id="next-lightbox" class="absolute right-6 text-white text-5xl font-bold cursor-pointer select-none hover:text-gray-300 transition-colors">&#10095;</span>
        <div id="lightbox-caption" class="absolute bottom-6 text-white text-center w-full text-lg p-2 bg-black bg-opacity-50 rounded-b-lg"></div>
    </div>

    <button id="toggle-project-music-player-btn" aria-label="Toggle Music Player">
        <i class="fas fa-music"></i> </button>
    <div id="project-page-music-player-panel" class="hidden-player"> <h4>Music Player</h4>
        <iframe id="project-soundcloud-iframe-player"
            width="100%"
            height="120" scrolling="no"
            frameborder="no"
            allow="autoplay"
            src="https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/seyit-kubilay-ulucay/sets/website&color=%23ff5500&auto_play=false&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=true&visual=false">
        </iframe>
        <div id="project-volume-controls-container" class="mt-2">
            <div class="flex items-center space-x-2">
                <button id="project-mute-toggle-btn" aria-label="Mute/Unmute" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors">
                    <i class="fas fa-volume-up text-[var(--text-color-secondary)]"></i>
                </button>
                <input type="range" id="project-volume-slider" min="0" max="100" value="50" class="w-full h-2 rounded-lg appearance-none cursor-pointer volume-slider-thumb">
            </div>
        </div>
    </div>

    <footer class="footer-bg py-6 mt-20 relative font-rubik">
        <div class="container mx-auto px-6 flex flex-col md:flex-row justify-center items-center">
            <p class="footer-text text-center">
                Â© <span id="current-year"></span> Seyit Kubilay Ulucay.
            </p>
        </div>
        <img
            id="easter-egg-cat"
            src="images/peek-cat.gif" onerror="this.src='https://placehold.co/64x64/333/ccc?text=Peek'" alt="Peeking Cat"
            class="absolute bottom-0 right-4 w-16 opacity-50 hover:opacity-100 transition-opacity cursor-pointer"
            title="Meow?"
        >
    </footer>

    <script src="https://w.soundcloud.com/player/api.js"></script>
    <script>
        // --- Footer Year & Basic Theme Application ---
        const yearElement = document.getElementById("current-year");
        if (yearElement) { yearElement.textContent = new Date().getFullYear(); }

        const applyProjectPageTheme = () => {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
            } else {
                document.body.classList.remove('dark-theme');
            }
            if (typeof updateProjectVolumeSliderAppearance === 'function') {
                updateProjectVolumeSliderAppearance();
            }
        };
        applyProjectPageTheme();

        // --- Music Player & Lightbox Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            applyProjectPageTheme(); 

            // --- Lightbox Gallery Logic ---
            const galleryItems = document.querySelectorAll('.gallery-item');
            const lightboxModal = document.getElementById('lightbox-modal');
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxCaption = document.getElementById('lightbox-caption');
            const closeBtn = document.getElementById('close-lightbox');
            const prevBtn = document.getElementById('prev-lightbox');
            const nextBtn = document.getElementById('next-lightbox');
            let currentIndex = 0;

            if (galleryItems.length > 0) {
                const openLightbox = (index) => {
                    currentIndex = index;
                    updateLightboxContent();
                    lightboxModal.classList.remove('hidden');
                    document.body.classList.add('lightbox-open');
                };

                const closeLightbox = () => {
                    lightboxModal.classList.add('hidden');
                    document.body.classList.remove('lightbox-open');
                };
                
                const updateLightboxContent = () => {
                    const item = galleryItems[currentIndex];
                    const imgSrc = item.getAttribute('href');
                    const captionText = item.getAttribute('data-caption');
                    lightboxImage.setAttribute('src', imgSrc);
                    lightboxCaption.textContent = captionText;
                };

                const showNextImage = () => {
                    currentIndex = (currentIndex + 1) % galleryItems.length;
                    updateLightboxContent();
                };

                const showPrevImage = () => {
                    currentIndex = (currentIndex - 1 + galleryItems.length) % galleryItems.length;
                    updateLightboxContent();
                };

                galleryItems.forEach((item, index) => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        openLightbox(index);
                    });
                });

                if (closeBtn) closeBtn.addEventListener('click', closeLightbox);
                if (prevBtn) prevBtn.addEventListener('click', showPrevImage);
                if (nextBtn) nextBtn.addEventListener('click', showNextImage);
                if (lightboxModal) {
                    lightboxModal.addEventListener('click', (e) => {
                        if (e.target === lightboxModal) {
                            closeLightbox();
                        }
                    });
                }
            
                document.addEventListener('keydown', (e) => {
                    if (!lightboxModal.classList.contains('hidden')) {
                        if (e.key === 'Escape') closeLightbox();
                        if (e.key === 'ArrowRight') showNextImage();
                        if (e.key === 'ArrowLeft') showPrevImage();
                    }
                });
            }


            // --- Music Player Logic ---
            const projectMusicPlayerPanel = document.getElementById('project-page-music-player-panel');
            const toggleMusicPlayerButton = document.getElementById('toggle-project-music-player-btn');
            const toggleIcon = toggleMusicPlayerButton ? toggleMusicPlayerButton.querySelector('i') : null;

            const projectSoundcloudIframe = document.getElementById('project-soundcloud-iframe-player');
            const projectVolumeSlider = document.getElementById('project-volume-slider');
            const projectMuteToggleButton = document.getElementById('project-mute-toggle-btn');
            let projectScWidget = null;
            let projectIsMuted = false;
            let projectLastVolume = 50;

            if (toggleMusicPlayerButton && projectMusicPlayerPanel && toggleIcon) {
                const isPlayerHidden = localStorage.getItem('projectPlayerHidden') === 'true';
                if (isPlayerHidden) {
                    projectMusicPlayerPanel.classList.add('hidden-player');
                    toggleIcon.classList.remove('fa-times'); 
                    toggleIcon.classList.add('fa-music');     
                } else {
                    projectMusicPlayerPanel.classList.remove('hidden-player');
                    toggleIcon.classList.remove('fa-music');
                    toggleIcon.classList.add('fa-times'); 
                }

                toggleMusicPlayerButton.addEventListener('click', () => {
                    const currentlyHidden = projectMusicPlayerPanel.classList.toggle('hidden-player');
                    localStorage.setItem('projectPlayerHidden', currentlyHidden);
                    if (currentlyHidden) {
                        toggleIcon.classList.remove('fa-times');
                        toggleIcon.classList.add('fa-music');
                    } else {
                        toggleIcon.classList.remove('fa-music');
                        toggleIcon.classList.add('fa-times');
                    }
                });
            }

            window.updateProjectVolumeSliderAppearance = () => { 
                if (!projectVolumeSlider) return;
                const progressPercent = projectVolumeSlider.value;
                const getProjectCssVariable = (varName) => document.body ? getComputedStyle(document.body).getPropertyValue(varName).trim() : null;
                const progressColor = getProjectCssVariable('--volume-slider-progress-bg') || '#FF61E1';
                const trackColor = getProjectCssVariable('--volume-slider-track-bg') || '#e5e7eb';
                projectVolumeSlider.style.background = `linear-gradient(to right, ${progressColor} ${progressPercent}%, ${trackColor} ${progressPercent}%)`;
            };

            if (projectSoundcloudIframe && typeof SC !== 'undefined') {
                projectScWidget = SC.Widget(projectSoundcloudIframe);
                projectScWidget.bind(SC.Widget.Events.READY, () => { 
                    console.log('SoundCloud Widget is ready on project page.');
                    const savedTrackURI = localStorage.getItem('soundcloudTrackURI');
                    const savedTrackTimeStr = localStorage.getItem('soundcloudTrackTime');
                    const savedVolumeStr = localStorage.getItem('soundcloudVolume');
                    const savedMutedStr = localStorage.getItem('soundcloudMuted');
                    const savedIsPlayingStr = localStorage.getItem('soundcloudIsPlaying');
                    let playAfterLoad = savedIsPlayingStr === 'true';

                    if (savedVolumeStr !== null) {
                        projectLastVolume = parseInt(savedVolumeStr, 10);
                        if(projectVolumeSlider) projectVolumeSlider.value = projectLastVolume;
                        projectScWidget.setVolume(projectLastVolume);
                    } else {
                         if(projectVolumeSlider) projectVolumeSlider.value = projectLastVolume;
                         projectScWidget.setVolume(projectLastVolume);
                    }
                    if (savedMutedStr === 'true') {
                        projectIsMuted = true;
                        projectScWidget.setVolume(0);
                        if(projectVolumeSlider) projectVolumeSlider.value = 0;
                        if(projectMuteToggleButton) projectMuteToggleButton.innerHTML = '<i class="fas fa-volume-mute text-[var(--text-color-secondary)]"></i>';
                    } else {
                        projectIsMuted = false;
                          if(projectMuteToggleButton) projectMuteToggleButton.innerHTML = '<i class="fas fa-volume-up text-[var(--text-color-secondary)]"></i>';
                    }
                    updateProjectVolumeSliderAppearance();

                    if (savedTrackURI) {
                        projectScWidget.load(savedTrackURI, {
                            auto_play: playAfterLoad,
                            callback: () => {
                                if (savedTrackTimeStr) {
                                    projectScWidget.seekTo(parseInt(savedTrackTimeStr, 10));
                                }
                                if (playAfterLoad && projectScWidget.play) {
                                   setTimeout(() => projectScWidget.play(), 250);
                                }
                            }
                        });
                    }
                });
                projectScWidget.bind(SC.Widget.Events.ERROR, (err) => { console.error("Project Page SC Widget Error:", err);});
            }

            if (projectVolumeSlider && projectScWidget) { 
                projectVolumeSlider.addEventListener('input', () => {
                    const newVolume = parseInt(projectVolumeSlider.value, 10);
                    projectScWidget.setVolume(newVolume);
                    projectLastVolume = newVolume;
                    projectIsMuted = newVolume === 0;
                    localStorage.setItem('soundcloudVolume', newVolume.toString());
                    localStorage.setItem('soundcloudMuted', projectIsMuted.toString());
                    if(projectMuteToggleButton) projectMuteToggleButton.innerHTML = projectIsMuted ? '<i class="fas fa-volume-mute text-[var(--text-color-secondary)]"></i>' : '<i class="fas fa-volume-up text-[var(--text-color-secondary)]"></i>';
                    updateProjectVolumeSliderAppearance();
                });
            }

            if (projectMuteToggleButton && projectScWidget) { 
                projectMuteToggleButton.addEventListener('click', () => {
                    projectIsMuted = !projectIsMuted;
                    if (projectIsMuted) {
                        projectScWidget.getVolume((currentVolume) => {
                            if(currentVolume > 0) projectLastVolume = currentVolume;
                            projectScWidget.setVolume(0);
                            if(projectVolumeSlider) projectVolumeSlider.value = 0;
                            projectMuteToggleButton.innerHTML = '<i class="fas fa-volume-mute text-[var(--text-color-secondary)]"></i>';
                        });
                    } else {
                        const restoreVolume = projectLastVolume > 0 ? projectLastVolume : 50;
                        projectScWidget.setVolume(restoreVolume);
                        if(projectVolumeSlider) projectVolumeSlider.value = restoreVolume;
                        projectMuteToggleButton.innerHTML = '<i class="fas fa-volume-up text-[var(--text-color-secondary)]"></i>';
                    }
                    localStorage.setItem('soundcloudMuted', projectIsMuted.toString());
                    if (!projectIsMuted && projectVolumeSlider) localStorage.setItem('soundcloudVolume', projectVolumeSlider.value);
                    updateProjectVolumeSliderAppearance();
                });
            }
            if (typeof updateProjectVolumeSliderAppearance === 'function') {
                updateProjectVolumeSliderAppearance();
            }
        });
    </script>
</body>
</html>
